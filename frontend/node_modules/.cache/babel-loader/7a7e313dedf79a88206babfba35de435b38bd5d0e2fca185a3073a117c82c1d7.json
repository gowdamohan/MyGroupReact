{"ast":null,"code":"import _objectSpread from\"D:/MyGroupReact/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _objectWithoutProperties from\"D:/MyGroupReact/frontend/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js\";const _excluded=[\"children\",\"value\",\"index\"];import React,{useState,useEffect}from'react';import{Container,Typography,Grid,Card,CardContent,CardActions,Button,Box,Dialog,DialogTitle,DialogContent,DialogActions,TextField,FormControl,InputLabel,Select,MenuItem,Chip,IconButton,Menu,ListItemIcon,ListItemText,Fab,Divider,Paper,Tab,Tabs,LinearProgress}from'@mui/material';import{Add as AddIcon,MoreVert as MoreVertIcon,Edit as EditIcon,Delete as DeleteIcon,Visibility as ViewIcon,Favorite as FavoriteIcon,LocationOn as LocationIcon,Person as PersonIcon,Schedule as ScheduleIcon}from'@mui/icons-material';import{useAuth}from'../contexts/AuthContext';import api from'../services/api';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function TabPanel(props){const{children,value,index}=props,other=_objectWithoutProperties(props,_excluded);return/*#__PURE__*/_jsx(\"div\",_objectSpread(_objectSpread({role:\"tabpanel\",hidden:value!==index,id:\"needy-tabpanel-\".concat(index),\"aria-labelledby\":\"needy-tab-\".concat(index)},other),{},{children:value===index&&/*#__PURE__*/_jsx(Box,{sx:{p:0},children:children})}));}const Needy=()=>{const{user}=useAuth();const[tabValue,setTabValue]=useState(0);const[needyServices,setNeedyServices]=useState([]);const[loading,setLoading]=useState(true);const[createDialogOpen,setCreateDialogOpen]=useState(false);const[anchorEl,setAnchorEl]=useState(null);const[selectedService,setSelectedService]=useState(null);const[filterType,setFilterType]=useState('');const[filterUrgency,setFilterUrgency]=useState('');const[newService,setNewService]=useState({title:'',description:'',service_type:'financial',urgency_level:'medium',required_amount:0,beneficiary_name:'',beneficiary_phone:'',beneficiary_email:'',location:'',target_date:''});const serviceTypes=[{value:'financial',label:'Financial Aid',color:'#2e7d32'},{value:'medical',label:'Medical Support',color:'#d32f2f'},{value:'education',label:'Education',color:'#1976d2'},{value:'food',label:'Food Support',color:'#f57c00'},{value:'shelter',label:'Shelter',color:'#5d4037'},{value:'clothing',label:'Clothing',color:'#7b1fa2'},{value:'other',label:'Other',color:'#616161'}];const urgencyLevels=[{value:'low',label:'Low',color:'#4caf50'},{value:'medium',label:'Medium',color:'#ff9800'},{value:'high',label:'High',color:'#f44336'},{value:'critical',label:'Critical',color:'#9c27b0'}];const statusColors={active:'success',completed:'info',cancelled:'error',pending:'warning'};useEffect(()=>{fetchNeedyServices();},[]);const fetchNeedyServices=async()=>{try{const response=await api.get('/needy-services');setNeedyServices(response.data);}catch(error){console.error('Failed to fetch needy services:',error);}finally{setLoading(false);}};const handleTabChange=(event,newValue)=>{setTabValue(newValue);};const handleCreateService=async()=>{try{const response=await api.post('/needy-services',newService);setNeedyServices([response.data,...needyServices]);setCreateDialogOpen(false);setNewService({title:'',description:'',service_type:'financial',urgency_level:'medium',required_amount:0,beneficiary_name:'',beneficiary_phone:'',beneficiary_email:'',location:'',target_date:''});}catch(error){console.error('Failed to create needy service:',error);}};const handleMenuClick=(event,service)=>{setAnchorEl(event.currentTarget);setSelectedService(service);};const handleMenuClose=()=>{setAnchorEl(null);setSelectedService(null);};const getServiceTypeColor=type=>{const serviceType=serviceTypes.find(st=>st.value===type);return serviceType?serviceType.color:'#616161';};const getUrgencyColor=urgency=>{const urgencyLevel=urgencyLevels.find(ul=>ul.value===urgency);return urgencyLevel?urgencyLevel.color:'#616161';};const calculateProgress=(raised,required)=>{return required>0?raised/required*100:0;};const filteredServices=needyServices.filter(service=>{const typeMatch=!filterType||service.service_type===filterType;const urgencyMatch=!filterUrgency||service.urgency_level===filterUrgency;return typeMatch&&urgencyMatch;});const renderServiceCard=service=>{var _serviceTypes$find,_urgencyLevels$find;const progress=calculateProgress(service.raised_amount,service.required_amount);return/*#__PURE__*/_jsxs(Card,{sx:{height:'100%',display:'flex',flexDirection:'column'},children:[/*#__PURE__*/_jsxs(CardContent,{sx:{flexGrow:1},children:[/*#__PURE__*/_jsxs(Box,{display:\"flex\",justifyContent:\"space-between\",alignItems:\"flex-start\",mb:2,children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",component:\"h2\",children:service.title}),/*#__PURE__*/_jsx(IconButton,{size:\"small\",onClick:e=>handleMenuClick(e,service),children:/*#__PURE__*/_jsx(MoreVertIcon,{})})]}),/*#__PURE__*/_jsxs(Box,{display:\"flex\",alignItems:\"center\",gap:1,mb:2,children:[/*#__PURE__*/_jsx(Chip,{label:(_serviceTypes$find=serviceTypes.find(st=>st.value===service.service_type))===null||_serviceTypes$find===void 0?void 0:_serviceTypes$find.label,size:\"small\",sx:{bgcolor:getServiceTypeColor(service.service_type),color:'white'}}),/*#__PURE__*/_jsx(Chip,{label:(_urgencyLevels$find=urgencyLevels.find(ul=>ul.value===service.urgency_level))===null||_urgencyLevels$find===void 0?void 0:_urgencyLevels$find.label,size:\"small\",sx:{bgcolor:getUrgencyColor(service.urgency_level),color:'white'}}),/*#__PURE__*/_jsx(Chip,{label:service.status,size:\"small\",color:statusColors[service.status],variant:\"outlined\"})]}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"textSecondary\",paragraph:true,children:service.description}),/*#__PURE__*/_jsxs(Box,{mb:2,children:[/*#__PURE__*/_jsxs(Box,{display:\"flex\",justifyContent:\"space-between\",alignItems:\"center\",mb:1,children:[/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",fontWeight:\"bold\",children:[\"\\u20B9\",service.raised_amount.toLocaleString(),\" raised\"]}),/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",color:\"textSecondary\",children:[\"of \\u20B9\",service.required_amount.toLocaleString()]})]}),/*#__PURE__*/_jsx(LinearProgress,{variant:\"determinate\",value:Math.min(progress,100),sx:{height:8,borderRadius:4}}),/*#__PURE__*/_jsxs(Typography,{variant:\"caption\",color:\"textSecondary\",children:[progress.toFixed(1),\"% funded\"]})]}),/*#__PURE__*/_jsxs(Box,{display:\"flex\",alignItems:\"center\",gap:1,mb:1,children:[/*#__PURE__*/_jsx(PersonIcon,{fontSize:\"small\",color:\"action\"}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"textSecondary\",children:service.beneficiary_name})]}),/*#__PURE__*/_jsxs(Box,{display:\"flex\",alignItems:\"center\",gap:1,mb:1,children:[/*#__PURE__*/_jsx(LocationIcon,{fontSize:\"small\",color:\"action\"}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"textSecondary\",children:service.location})]}),/*#__PURE__*/_jsxs(Box,{display:\"flex\",alignItems:\"center\",gap:1,mb:2,children:[/*#__PURE__*/_jsx(FavoriteIcon,{fontSize:\"small\",color:\"action\"}),/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",color:\"textSecondary\",children:[service.supporters_count,\" supporters\"]})]}),service.target_date&&/*#__PURE__*/_jsxs(Box,{display:\"flex\",alignItems:\"center\",gap:1,children:[/*#__PURE__*/_jsx(ScheduleIcon,{fontSize:\"small\",color:\"action\"}),/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",color:\"textSecondary\",children:[\"Target: \",new Date(service.target_date).toLocaleDateString()]})]})]}),/*#__PURE__*/_jsxs(CardActions,{children:[/*#__PURE__*/_jsx(Button,{size:\"small\",variant:\"contained\",color:\"primary\",children:\"Support\"}),/*#__PURE__*/_jsx(Button,{size:\"small\",startIcon:/*#__PURE__*/_jsx(ViewIcon,{}),children:\"Details\"}),/*#__PURE__*/_jsx(Button,{size:\"small\",startIcon:/*#__PURE__*/_jsx(FavoriteIcon,{}),children:service.supporters_count})]})]},service.id);};return/*#__PURE__*/_jsxs(Container,{maxWidth:\"lg\",sx:{mt:4,mb:4},children:[/*#__PURE__*/_jsxs(Box,{display:\"flex\",justifyContent:\"space-between\",alignItems:\"center\",mb:4,children:[/*#__PURE__*/_jsx(Typography,{variant:\"h4\",component:\"h1\",fontWeight:\"bold\",children:\"Needy Services\"}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",startIcon:/*#__PURE__*/_jsx(AddIcon,{}),onClick:()=>setCreateDialogOpen(true),size:\"large\",children:\"Add Service Request\"})]}),/*#__PURE__*/_jsx(Paper,{sx:{width:'100%',mb:3},children:/*#__PURE__*/_jsxs(Tabs,{value:tabValue,onChange:handleTabChange,\"aria-label\":\"needy tabs\",children:[/*#__PURE__*/_jsx(Tab,{label:\"All Services\"}),/*#__PURE__*/_jsx(Tab,{label:\"My Requests\"}),/*#__PURE__*/_jsx(Tab,{label:\"Supported\"}),/*#__PURE__*/_jsx(Tab,{label:\"Categories\"})]})}),/*#__PURE__*/_jsx(Paper,{sx:{p:2,mb:3},children:/*#__PURE__*/_jsxs(Grid,{container:true,spacing:2,alignItems:\"center\",children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:4,children:/*#__PURE__*/_jsxs(FormControl,{fullWidth:true,size:\"small\",children:[/*#__PURE__*/_jsx(InputLabel,{children:\"Service Type\"}),/*#__PURE__*/_jsxs(Select,{value:filterType,onChange:e=>setFilterType(e.target.value),label:\"Service Type\",children:[/*#__PURE__*/_jsx(MenuItem,{value:\"\",children:\"All Types\"}),serviceTypes.map(type=>/*#__PURE__*/_jsx(MenuItem,{value:type.value,children:type.label},type.value))]})]})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:4,children:/*#__PURE__*/_jsxs(FormControl,{fullWidth:true,size:\"small\",children:[/*#__PURE__*/_jsx(InputLabel,{children:\"Urgency Level\"}),/*#__PURE__*/_jsxs(Select,{value:filterUrgency,onChange:e=>setFilterUrgency(e.target.value),label:\"Urgency Level\",children:[/*#__PURE__*/_jsx(MenuItem,{value:\"\",children:\"All Levels\"}),urgencyLevels.map(level=>/*#__PURE__*/_jsx(MenuItem,{value:level.value,children:level.label},level.value))]})]})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:4,children:/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",color:\"textSecondary\",children:[filteredServices.length,\" services found\"]})})]})}),/*#__PURE__*/_jsx(TabPanel,{value:tabValue,index:0,children:/*#__PURE__*/_jsxs(Grid,{container:true,spacing:3,children:[filteredServices.map(service=>/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:6,lg:4,children:renderServiceCard(service)},service.id)),filteredServices.length===0&&/*#__PURE__*/_jsx(Grid,{item:true,xs:12,children:/*#__PURE__*/_jsxs(Box,{textAlign:\"center\",py:8,children:[/*#__PURE__*/_jsx(FavoriteIcon,{sx:{fontSize:64,color:'text.secondary',mb:2}}),/*#__PURE__*/_jsx(Typography,{variant:\"h6\",color:\"textSecondary\",gutterBottom:true,children:\"No needy services found\"}),/*#__PURE__*/_jsx(Typography,{variant:\"body1\",color:\"textSecondary\",mb:3,children:\"Help make a difference by creating or supporting service requests.\"}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",startIcon:/*#__PURE__*/_jsx(AddIcon,{}),onClick:()=>setCreateDialogOpen(true),children:\"Create Service Request\"})]})})]})}),/*#__PURE__*/_jsx(TabPanel,{value:tabValue,index:1,children:/*#__PURE__*/_jsx(Typography,{variant:\"h6\",gutterBottom:true,children:\"My Service Requests\"})}),/*#__PURE__*/_jsx(TabPanel,{value:tabValue,index:2,children:/*#__PURE__*/_jsx(Typography,{variant:\"h6\",gutterBottom:true,children:\"Services I Support\"})}),/*#__PURE__*/_jsx(TabPanel,{value:tabValue,index:3,children:/*#__PURE__*/_jsx(Typography,{variant:\"h6\",gutterBottom:true,children:\"Service Categories\"})}),/*#__PURE__*/_jsxs(Dialog,{open:createDialogOpen,onClose:()=>setCreateDialogOpen(false),maxWidth:\"md\",fullWidth:true,children:[/*#__PURE__*/_jsx(DialogTitle,{children:\"Create Service Request\"}),/*#__PURE__*/_jsx(DialogContent,{children:/*#__PURE__*/_jsxs(Grid,{container:true,spacing:2,sx:{mt:1},children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:12,children:/*#__PURE__*/_jsx(TextField,{fullWidth:true,label:\"Service Title\",value:newService.title,onChange:e=>setNewService(_objectSpread(_objectSpread({},newService),{},{title:e.target.value})),required:true})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,children:/*#__PURE__*/_jsxs(FormControl,{fullWidth:true,children:[/*#__PURE__*/_jsx(InputLabel,{children:\"Service Type\"}),/*#__PURE__*/_jsx(Select,{value:newService.service_type,onChange:e=>setNewService(_objectSpread(_objectSpread({},newService),{},{service_type:e.target.value})),label:\"Service Type\",required:true,children:serviceTypes.map(type=>/*#__PURE__*/_jsx(MenuItem,{value:type.value,children:type.label},type.value))})]})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,children:/*#__PURE__*/_jsxs(FormControl,{fullWidth:true,children:[/*#__PURE__*/_jsx(InputLabel,{children:\"Urgency Level\"}),/*#__PURE__*/_jsx(Select,{value:newService.urgency_level,onChange:e=>setNewService(_objectSpread(_objectSpread({},newService),{},{urgency_level:e.target.value})),label:\"Urgency Level\",required:true,children:urgencyLevels.map(level=>/*#__PURE__*/_jsx(MenuItem,{value:level.value,children:level.label},level.value))})]})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,children:/*#__PURE__*/_jsx(TextField,{fullWidth:true,label:\"Description\",value:newService.description,onChange:e=>setNewService(_objectSpread(_objectSpread({},newService),{},{description:e.target.value})),multiline:true,rows:3,required:true})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,children:/*#__PURE__*/_jsx(TextField,{fullWidth:true,label:\"Required Amount (\\u20B9)\",type:\"number\",value:newService.required_amount,onChange:e=>setNewService(_objectSpread(_objectSpread({},newService),{},{required_amount:parseInt(e.target.value)||0}))})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,children:/*#__PURE__*/_jsx(TextField,{fullWidth:true,label:\"Target Date\",type:\"date\",value:newService.target_date,onChange:e=>setNewService(_objectSpread(_objectSpread({},newService),{},{target_date:e.target.value})),InputLabelProps:{shrink:true}})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,children:/*#__PURE__*/_jsx(TextField,{fullWidth:true,label:\"Beneficiary Name\",value:newService.beneficiary_name,onChange:e=>setNewService(_objectSpread(_objectSpread({},newService),{},{beneficiary_name:e.target.value})),required:true})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,children:/*#__PURE__*/_jsx(TextField,{fullWidth:true,label:\"Beneficiary Phone\",value:newService.beneficiary_phone,onChange:e=>setNewService(_objectSpread(_objectSpread({},newService),{},{beneficiary_phone:e.target.value}))})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,children:/*#__PURE__*/_jsx(TextField,{fullWidth:true,label:\"Beneficiary Email\",type:\"email\",value:newService.beneficiary_email,onChange:e=>setNewService(_objectSpread(_objectSpread({},newService),{},{beneficiary_email:e.target.value}))})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,children:/*#__PURE__*/_jsx(TextField,{fullWidth:true,label:\"Location\",value:newService.location,onChange:e=>setNewService(_objectSpread(_objectSpread({},newService),{},{location:e.target.value})),required:true})})]})}),/*#__PURE__*/_jsxs(DialogActions,{children:[/*#__PURE__*/_jsx(Button,{onClick:()=>setCreateDialogOpen(false),children:\"Cancel\"}),/*#__PURE__*/_jsx(Button,{onClick:handleCreateService,variant:\"contained\",disabled:!newService.title||!newService.beneficiary_name||!newService.location,children:\"Create Request\"})]})]}),/*#__PURE__*/_jsxs(Menu,{anchorEl:anchorEl,open:Boolean(anchorEl),onClose:handleMenuClose,children:[/*#__PURE__*/_jsxs(MenuItem,{onClick:handleMenuClose,children:[/*#__PURE__*/_jsx(ListItemIcon,{children:/*#__PURE__*/_jsx(ViewIcon,{fontSize:\"small\"})}),/*#__PURE__*/_jsx(ListItemText,{children:\"View Details\"})]}),/*#__PURE__*/_jsxs(MenuItem,{onClick:handleMenuClose,children:[/*#__PURE__*/_jsx(ListItemIcon,{children:/*#__PURE__*/_jsx(EditIcon,{fontSize:\"small\"})}),/*#__PURE__*/_jsx(ListItemText,{children:\"Edit Request\"})]}),/*#__PURE__*/_jsxs(MenuItem,{onClick:handleMenuClose,children:[/*#__PURE__*/_jsx(ListItemIcon,{children:/*#__PURE__*/_jsx(FavoriteIcon,{fontSize:\"small\"})}),/*#__PURE__*/_jsx(ListItemText,{children:\"Support This\"})]}),/*#__PURE__*/_jsx(Divider,{}),/*#__PURE__*/_jsxs(MenuItem,{onClick:handleMenuClose,sx:{color:'error.main'},children:[/*#__PURE__*/_jsx(ListItemIcon,{children:/*#__PURE__*/_jsx(DeleteIcon,{fontSize:\"small\",color:\"error\"})}),/*#__PURE__*/_jsx(ListItemText,{children:\"Delete Request\"})]})]}),/*#__PURE__*/_jsx(Fab,{color:\"primary\",\"aria-label\":\"add\",sx:{position:'fixed',bottom:16,right:16,display:{xs:'flex',md:'none'}},onClick:()=>setCreateDialogOpen(true),children:/*#__PURE__*/_jsx(AddIcon,{})})]});};export default Needy;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}