{"ast":null,"code":"import React,{useState,useEffect}from'react';import{Box,Paper,Table,TableBody,TableCell,TableContainer,TableHead,TableRow,TextField,Button,Chip,Typography,Grid,Card,CardContent,IconButton,Dialog,DialogTitle,DialogContent,DialogActions,FormControl,InputLabel,Select,MenuItem}from'@mui/material';import{Search,Add,Edit,LocationOn}from'@mui/icons-material';import{useApi}from'../hooks/useApi';import api from'../services/api';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const AdminDistricts=()=>{const{data,loading,refetch}=useApi(()=>api.get('/admin/districts',{params:{countryId:countryFilter!=='all'?countryFilter:undefined,stateId:stateFilter!=='all'?stateFilter:undefined,search:search||undefined}}));const[districts,setDistricts]=useState([]);const[countries,setCountries]=useState([]);const[states,setStates]=useState([]);const[search,setSearch]=useState('');const[countryFilter,setCountryFilter]=useState('all');const[stateFilter,setStateFilter]=useState('all');const[openDialog,setOpenDialog]=useState(false);const[editingDistrict,setEditingDistrict]=useState(null);const[selectedCountry,setSelectedCountry]=useState('');const fetchDistricts=async()=>{/* refactored to use useApi */try{const params={};if(countryFilter!=='all')params.countryId=countryFilter;if(stateFilter!=='all')params.stateId=stateFilter;await refetch();if(data){setDistricts(data.districts||[]);}}catch(error){console.error('Error fetching districts:',error);}};const fetchCountries=async()=>{try{const res=await api.get('/admin/countries');if(res.data){setCountries(res.data.countries||[]);}}catch(error){console.error('Error fetching countries:',error);}};const fetchStates=async countryId=>{try{const res=await api.get('/admin/states',{params:countryId?{countryId}:{}});if(res.data){setStates(res.data.states||[]);}}catch(error){console.error('Error fetching states:',error);}};useEffect(()=>{fetchCountries();fetchStates();},[]);useEffect(()=>{fetchDistricts();},[countryFilter,stateFilter]);useEffect(()=>{if(countryFilter!=='all'){fetchStates(countryFilter);setStateFilter('all');}},[countryFilter]);const filteredDistricts=districts.filter(district=>{var _district$State,_district$Country;return district.district_name.toLowerCase().includes(search.toLowerCase())||((_district$State=district.State)===null||_district$State===void 0?void 0:_district$State.state_name.toLowerCase().includes(search.toLowerCase()))||((_district$Country=district.Country)===null||_district$Country===void 0?void 0:_district$Country.country_name.toLowerCase().includes(search.toLowerCase()));});const handleEdit=district=>{setEditingDistrict(district);setSelectedCountry(district.country_id.toString());setOpenDialog(true);};const handleCloseDialog=()=>{setOpenDialog(false);setEditingDistrict(null);setSelectedCountry('');};return/*#__PURE__*/_jsxs(Box,{sx:{p:3},children:[/*#__PURE__*/_jsxs(Typography,{variant:\"h4\",sx:{mb:3,display:'flex',alignItems:'center'},children:[/*#__PURE__*/_jsx(LocationOn,{sx:{mr:2}}),\"Districts Management\"]}),/*#__PURE__*/_jsxs(Grid,{container:true,spacing:3,sx:{mb:3},children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:3,children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",color:\"primary\",children:\"Total Districts\"}),/*#__PURE__*/_jsx(Typography,{variant:\"h4\",children:districts.length})]})})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:3,children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",color:\"success.main\",children:\"Active Districts\"}),/*#__PURE__*/_jsx(Typography,{variant:\"h4\",children:districts.filter(d=>d.status==='active').length})]})})})]}),/*#__PURE__*/_jsx(Paper,{sx:{p:2,mb:3},children:/*#__PURE__*/_jsxs(Grid,{container:true,spacing:2,alignItems:\"center\",children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:3,children:/*#__PURE__*/_jsx(TextField,{fullWidth:true,placeholder:\"Search districts...\",value:search,onChange:e=>setSearch(e.target.value),InputProps:{startAdornment:/*#__PURE__*/_jsx(Search,{sx:{color:'action.active',mr:1}})}})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:3,children:/*#__PURE__*/_jsxs(FormControl,{fullWidth:true,children:[/*#__PURE__*/_jsx(InputLabel,{children:\"Country\"}),/*#__PURE__*/_jsxs(Select,{value:countryFilter,onChange:e=>setCountryFilter(e.target.value),label:\"Country\",children:[/*#__PURE__*/_jsx(MenuItem,{value:\"all\",children:\"All Countries\"}),countries.map(country=>/*#__PURE__*/_jsx(MenuItem,{value:country.id,children:country.country_name},country.id))]})]})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:3,children:/*#__PURE__*/_jsxs(FormControl,{fullWidth:true,children:[/*#__PURE__*/_jsx(InputLabel,{children:\"State\"}),/*#__PURE__*/_jsxs(Select,{value:stateFilter,onChange:e=>setStateFilter(e.target.value),label:\"State\",disabled:countryFilter==='all',children:[/*#__PURE__*/_jsx(MenuItem,{value:\"all\",children:\"All States\"}),states.map(state=>/*#__PURE__*/_jsx(MenuItem,{value:state.id,children:state.state_name},state.id))]})]})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:3,children:/*#__PURE__*/_jsx(Button,{fullWidth:true,variant:\"contained\",startIcon:/*#__PURE__*/_jsx(Add,{}),onClick:()=>setOpenDialog(true),children:\"Add District\"})})]})}),/*#__PURE__*/_jsx(TableContainer,{component:Paper,children:/*#__PURE__*/_jsxs(Table,{children:[/*#__PURE__*/_jsx(TableHead,{children:/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{children:\"District Name\"}),/*#__PURE__*/_jsx(TableCell,{children:\"State\"}),/*#__PURE__*/_jsx(TableCell,{children:\"Country\"}),/*#__PURE__*/_jsx(TableCell,{children:\"Status\"}),/*#__PURE__*/_jsx(TableCell,{children:\"Created Date\"}),/*#__PURE__*/_jsx(TableCell,{children:\"Actions\"})]})}),/*#__PURE__*/_jsx(TableBody,{children:loading?/*#__PURE__*/_jsx(TableRow,{children:/*#__PURE__*/_jsx(TableCell,{colSpan:6,align:\"center\",children:\"Loading...\"})}):filteredDistricts.length===0?/*#__PURE__*/_jsx(TableRow,{children:/*#__PURE__*/_jsx(TableCell,{colSpan:6,align:\"center\",children:\"No districts found\"})}):filteredDistricts.map(district=>{var _district$State2,_district$Country2;return/*#__PURE__*/_jsxs(TableRow,{hover:true,children:[/*#__PURE__*/_jsx(TableCell,{children:/*#__PURE__*/_jsx(Typography,{variant:\"subtitle2\",children:district.district_name})}),/*#__PURE__*/_jsx(TableCell,{children:/*#__PURE__*/_jsx(Typography,{variant:\"body2\",children:((_district$State2=district.State)===null||_district$State2===void 0?void 0:_district$State2.state_name)||'N/A'})}),/*#__PURE__*/_jsx(TableCell,{children:/*#__PURE__*/_jsx(Typography,{variant:\"body2\",children:((_district$Country2=district.Country)===null||_district$Country2===void 0?void 0:_district$Country2.country_name)||'N/A'})}),/*#__PURE__*/_jsx(TableCell,{children:/*#__PURE__*/_jsx(Chip,{label:district.status,color:district.status==='active'?'success':'default',size:\"small\"})}),/*#__PURE__*/_jsx(TableCell,{children:/*#__PURE__*/_jsx(Typography,{variant:\"body2\",children:new Date(district.created_date).toLocaleDateString()})}),/*#__PURE__*/_jsx(TableCell,{children:/*#__PURE__*/_jsx(IconButton,{onClick:()=>handleEdit(district),children:/*#__PURE__*/_jsx(Edit,{})})})]},district.id);})})]})}),/*#__PURE__*/_jsxs(Dialog,{open:openDialog,onClose:handleCloseDialog,maxWidth:\"sm\",fullWidth:true,children:[/*#__PURE__*/_jsx(DialogTitle,{children:editingDistrict?'Edit District':'Add District'}),/*#__PURE__*/_jsxs(DialogContent,{children:[/*#__PURE__*/_jsx(TextField,{fullWidth:true,label:\"District Name\",margin:\"normal\",defaultValue:(editingDistrict===null||editingDistrict===void 0?void 0:editingDistrict.district_name)||''}),/*#__PURE__*/_jsxs(FormControl,{fullWidth:true,margin:\"normal\",children:[/*#__PURE__*/_jsx(InputLabel,{children:\"Country\"}),/*#__PURE__*/_jsx(Select,{value:selectedCountry,onChange:e=>{setSelectedCountry(e.target.value);fetchStates(e.target.value);},label:\"Country\",children:countries.map(country=>/*#__PURE__*/_jsx(MenuItem,{value:country.id,children:country.country_name},country.id))})]}),/*#__PURE__*/_jsxs(FormControl,{fullWidth:true,margin:\"normal\",children:[/*#__PURE__*/_jsx(InputLabel,{children:\"State\"}),/*#__PURE__*/_jsx(Select,{defaultValue:(editingDistrict===null||editingDistrict===void 0?void 0:editingDistrict.state_id)||'',label:\"State\",disabled:!selectedCountry,children:states.filter(s=>!selectedCountry||s.country_id.toString()===selectedCountry).map(state=>/*#__PURE__*/_jsx(MenuItem,{value:state.id,children:state.state_name},state.id))})]})]}),/*#__PURE__*/_jsxs(DialogActions,{children:[/*#__PURE__*/_jsx(Button,{onClick:handleCloseDialog,children:\"Cancel\"}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",children:editingDistrict?'Update':'Add'})]})]})]});};export default AdminDistricts;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}