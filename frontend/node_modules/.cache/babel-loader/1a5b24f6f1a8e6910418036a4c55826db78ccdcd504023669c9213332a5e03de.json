{"ast":null,"code":"import React,{useState,useEffect}from'react';import{Box,Card,CardContent,Typography,Table,TableBody,TableCell,TableContainer,TableHead,TableRow,Paper,Button,Dialog,DialogTitle,DialogContent,DialogActions,TextField,Select,MenuItem,FormControl,InputLabel,Chip,IconButton,Tooltip}from'@mui/material';import{Add as AddIcon,Edit as EditIcon,Visibility as ViewIcon,Block as BlockIcon,CheckCircle as CheckCircleIcon}from'@mui/icons-material';import{useApi}from'../hooks/useApi';import api from'../services/api';import LoadingSpinner from'../components/LoadingSpinner';import ErrorAlert from'../components/ErrorAlert';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const AdminUsers=()=>{const[users,setUsers]=useState([]);const[filteredUsers,setFilteredUsers]=useState([]);const[searchTerm,setSearchTerm]=useState('');const[roleFilter,setRoleFilter]=useState('all');const[statusFilter,setStatusFilter]=useState('all');const[selectedUser,setSelectedUser]=useState(null);const[dialogOpen,setDialogOpen]=useState(false);const[dialogMode,setDialogMode]=useState('view');const{data:usersData,loading,error,refetch}=useApi(()=>api.get('/admin/users'));useEffect(()=>{if(usersData){setUsers(usersData.users||[]);}},[usersData]);useEffect(()=>{let filtered=users;if(searchTerm){filtered=filtered.filter(user=>user.first_name.toLowerCase().includes(searchTerm.toLowerCase())||user.last_name.toLowerCase().includes(searchTerm.toLowerCase())||user.email.toLowerCase().includes(searchTerm.toLowerCase()));}if(roleFilter!=='all'){filtered=filtered.filter(user=>user.role===roleFilter);}if(statusFilter!=='all'){filtered=filtered.filter(user=>statusFilter==='active'?user.active:!user.active);}setFilteredUsers(filtered);},[users,searchTerm,roleFilter,statusFilter]);const handleOpenDialog=(mode,user)=>{setDialogMode(mode);setSelectedUser(user||null);setDialogOpen(true);};const handleCloseDialog=()=>{setDialogOpen(false);setSelectedUser(null);};const handleToggleUserStatus=async(userId,currentStatus)=>{try{await fetch(\"/api/admin/users/\".concat(userId,\"/toggle-status\"),{method:'PATCH',headers:{'Content-Type':'application/json','Authorization':\"Bearer \".concat(localStorage.getItem('token'))},body:JSON.stringify({active:!currentStatus})});refetch();}catch(error){console.error('Error toggling user status:',error);}};const getStatusChip=active=>/*#__PURE__*/_jsx(Chip,{label:active?'Active':'Inactive',color:active?'success':'error',size:\"small\"});const getRoleChip=role=>{const colors={admin:'primary',user:'secondary',moderator:'warning',client:'info'};return/*#__PURE__*/_jsx(Chip,{label:role.charAt(0).toUpperCase()+role.slice(1),color:colors[role]||'default',size:\"small\"});};if(loading)return/*#__PURE__*/_jsx(LoadingSpinner,{});if(error)return/*#__PURE__*/_jsx(ErrorAlert,{error:error});return/*#__PURE__*/_jsxs(Box,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"h4\",gutterBottom:true,children:\"User Management\"}),/*#__PURE__*/_jsx(Card,{sx:{mb:3},children:/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',gap:2,mb:2,flexWrap:'wrap'},children:[/*#__PURE__*/_jsx(TextField,{label:\"Search Users\",variant:\"outlined\",size:\"small\",value:searchTerm,onChange:e=>setSearchTerm(e.target.value),sx:{minWidth:250}}),/*#__PURE__*/_jsxs(FormControl,{size:\"small\",sx:{minWidth:120},children:[/*#__PURE__*/_jsx(InputLabel,{children:\"Role\"}),/*#__PURE__*/_jsxs(Select,{value:roleFilter,onChange:e=>setRoleFilter(e.target.value),label:\"Role\",children:[/*#__PURE__*/_jsx(MenuItem,{value:\"all\",children:\"All Roles\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"admin\",children:\"Admin\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"user\",children:\"User\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"moderator\",children:\"Moderator\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"client\",children:\"Client\"})]})]}),/*#__PURE__*/_jsxs(FormControl,{size:\"small\",sx:{minWidth:120},children:[/*#__PURE__*/_jsx(InputLabel,{children:\"Status\"}),/*#__PURE__*/_jsxs(Select,{value:statusFilter,onChange:e=>setStatusFilter(e.target.value),label:\"Status\",children:[/*#__PURE__*/_jsx(MenuItem,{value:\"all\",children:\"All Status\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"active\",children:\"Active\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"inactive\",children:\"Inactive\"})]})]}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",startIcon:/*#__PURE__*/_jsx(AddIcon,{}),onClick:()=>handleOpenDialog('create'),children:\"Add User\"})]}),/*#__PURE__*/_jsx(TableContainer,{component:Paper,children:/*#__PURE__*/_jsxs(Table,{children:[/*#__PURE__*/_jsx(TableHead,{children:/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{children:\"Name\"}),/*#__PURE__*/_jsx(TableCell,{children:\"Email\"}),/*#__PURE__*/_jsx(TableCell,{children:\"Phone\"}),/*#__PURE__*/_jsx(TableCell,{children:\"Role\"}),/*#__PURE__*/_jsx(TableCell,{children:\"Status\"}),/*#__PURE__*/_jsx(TableCell,{children:\"Registered\"}),/*#__PURE__*/_jsx(TableCell,{children:\"Last Login\"}),/*#__PURE__*/_jsx(TableCell,{children:\"Actions\"})]})}),/*#__PURE__*/_jsx(TableBody,{children:filteredUsers.map(user=>/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsxs(TableCell,{children:[user.first_name,\" \",user.last_name]}),/*#__PURE__*/_jsx(TableCell,{children:user.email}),/*#__PURE__*/_jsx(TableCell,{children:user.phone||'-'}),/*#__PURE__*/_jsx(TableCell,{children:getRoleChip(user.role)}),/*#__PURE__*/_jsx(TableCell,{children:getStatusChip(user.active)}),/*#__PURE__*/_jsx(TableCell,{children:new Date(user.created_on).toLocaleDateString()}),/*#__PURE__*/_jsx(TableCell,{children:user.last_login?new Date(user.last_login).toLocaleDateString():'Never'}),/*#__PURE__*/_jsxs(TableCell,{children:[/*#__PURE__*/_jsx(Tooltip,{title:\"View Details\",children:/*#__PURE__*/_jsx(IconButton,{size:\"small\",onClick:()=>handleOpenDialog('view',user),children:/*#__PURE__*/_jsx(ViewIcon,{})})}),/*#__PURE__*/_jsx(Tooltip,{title:\"Edit User\",children:/*#__PURE__*/_jsx(IconButton,{size:\"small\",onClick:()=>handleOpenDialog('edit',user),children:/*#__PURE__*/_jsx(EditIcon,{})})}),/*#__PURE__*/_jsx(Tooltip,{title:user.active?'Block User':'Activate User',children:/*#__PURE__*/_jsx(IconButton,{size:\"small\",onClick:()=>handleToggleUserStatus(user.id,user.active),children:user.active?/*#__PURE__*/_jsx(BlockIcon,{}):/*#__PURE__*/_jsx(CheckCircleIcon,{})})})]})]},user.id))})]})})]})}),/*#__PURE__*/_jsxs(Dialog,{open:dialogOpen,onClose:handleCloseDialog,maxWidth:\"md\",fullWidth:true,children:[/*#__PURE__*/_jsxs(DialogTitle,{children:[dialogMode==='create'&&'Create New User',dialogMode==='edit'&&'Edit User',dialogMode==='view'&&'User Details']}),/*#__PURE__*/_jsx(DialogContent,{children:selectedUser&&/*#__PURE__*/_jsxs(Box,{sx:{mt:2},children:[/*#__PURE__*/_jsxs(Typography,{variant:\"h6\",gutterBottom:true,children:[selectedUser.first_name,\" \",selectedUser.last_name]}),/*#__PURE__*/_jsxs(Typography,{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Email:\"}),\" \",selectedUser.email]}),/*#__PURE__*/_jsxs(Typography,{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Phone:\"}),\" \",selectedUser.phone||'Not provided']}),/*#__PURE__*/_jsxs(Typography,{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Role:\"}),\" \",selectedUser.role]}),/*#__PURE__*/_jsxs(Typography,{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Status:\"}),\" \",selectedUser.active?'Active':'Inactive']}),/*#__PURE__*/_jsxs(Typography,{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Registered:\"}),\" \",new Date(selectedUser.created_on).toLocaleString()]}),selectedUser.profile&&/*#__PURE__*/_jsxs(Box,{sx:{mt:2},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",gutterBottom:true,children:\"Profile Information\"}),/*#__PURE__*/_jsxs(Typography,{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Profession:\"}),\" \",selectedUser.profile.profession]}),/*#__PURE__*/_jsxs(Typography,{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Location:\"}),\" \",selectedUser.profile.city,\", \",selectedUser.profile.state,\", \",selectedUser.profile.country]})]})]})}),/*#__PURE__*/_jsxs(DialogActions,{children:[/*#__PURE__*/_jsx(Button,{onClick:handleCloseDialog,children:dialogMode==='view'?'Close':'Cancel'}),dialogMode!=='view'&&/*#__PURE__*/_jsx(Button,{variant:\"contained\",onClick:handleCloseDialog,children:dialogMode==='create'?'Create':'Save'})]})]})]});};export default AdminUsers;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}