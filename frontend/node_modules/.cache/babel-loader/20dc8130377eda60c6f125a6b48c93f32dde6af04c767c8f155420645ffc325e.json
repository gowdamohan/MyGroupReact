{"ast":null,"code":"import _objectSpread from\"D:/MyGroupReact/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _objectWithoutProperties from\"D:/MyGroupReact/frontend/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js\";const _excluded=[\"children\",\"value\",\"index\"];import React,{useState,useEffect}from'react';import{Container,Paper,Typography,TextField,Button,Grid,Box,Alert,Tab,Tabs,FormControl,InputLabel,Select,MenuItem,CircularProgress}from'@mui/material';import{useForm}from'react-hook-form';import{useAuth}from'../contexts/AuthContext';import{usersAPI,geographicAPI}from'../services/api';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function TabPanel(props){const{children,value,index}=props,other=_objectWithoutProperties(props,_excluded);return/*#__PURE__*/_jsx(\"div\",_objectSpread(_objectSpread({role:\"tabpanel\",hidden:value!==index,id:\"profile-tabpanel-\".concat(index),\"aria-labelledby\":\"profile-tab-\".concat(index)},other),{},{children:value===index&&/*#__PURE__*/_jsx(Box,{sx:{p:3},children:children})}));}const Profile=()=>{var _profileErrors$first_,_profileErrors$last_n,_profileErrors$full_n,_profileErrors$dob,_profileErrors$mobile,_profileErrors$altern,_profileErrors$addres,_profileErrors$pincod,_passwordErrors$curre,_passwordErrors$newPa;const{user,profile,updateUser}=useAuth();const[tabValue,setTabValue]=useState(0);const[loading,setLoading]=useState(false);const[message,setMessage]=useState('');const[error,setError]=useState('');// Geographic data\nconst[countries,setCountries]=useState([]);const[states,setStates]=useState([]);const[districts,setDistricts]=useState([]);const{register:registerProfile,handleSubmit:handleProfileSubmit,reset:resetProfile,watch,formState:{errors:profileErrors}}=useForm();const{register:registerPassword,handleSubmit:handlePasswordSubmit,reset:resetPassword,watch:watchPassword,formState:{errors:passwordErrors}}=useForm();const watchCountry=watch('country_id');const watchState=watch('state_id');const newPassword=watchPassword('newPassword');useEffect(()=>{// Load countries\nconst loadCountries=async()=>{try{const countriesData=await geographicAPI.getCountries();setCountries(countriesData);}catch(error){console.error('Failed to load countries:',error);}};loadCountries();},[]);useEffect(()=>{// Load states when country changes\nif(watchCountry){const loadStates=async()=>{try{const statesData=await geographicAPI.getStates(watchCountry);setStates(statesData);setDistricts([]);// Clear districts\n}catch(error){console.error('Failed to load states:',error);}};loadStates();}},[watchCountry]);useEffect(()=>{// Load districts when state changes\nif(watchState){const loadDistricts=async()=>{try{const districtsData=await geographicAPI.getDistricts(watchState);setDistricts(districtsData);}catch(error){console.error('Failed to load districts:',error);}};loadDistricts();}},[watchState]);useEffect(()=>{// Populate form with existing data\nif(user&&profile){resetProfile({first_name:user.first_name||'',last_name:user.last_name||'',phone:user.phone||'',full_name:profile.full_name||'',gender:profile.gender||undefined,dob:profile.dob?profile.dob.split('T')[0]:'',mobile:profile.mobile||'',alternate_mobile:profile.alternate_mobile||'',address:profile.address||'',pincode:profile.pincode||'',country_id:profile.country_id||undefined,state_id:profile.state_id||undefined,district_id:profile.district_id||undefined,profession_id:profile.profession_id||undefined,education_id:profile.education_id||undefined});}},[user,profile,resetProfile]);const handleTabChange=(event,newValue)=>{setTabValue(newValue);setMessage('');setError('');};const onProfileSubmit=async data=>{setLoading(true);setError('');setMessage('');try{await usersAPI.updateProfile(data);setMessage('Profile updated successfully!');// Refresh user data\nconst userData=await usersAPI.getProfile();updateUser(userData.user,userData.profile);}catch(err){var _err$response,_err$response$data;setError(((_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.message)||'Failed to update profile');}finally{setLoading(false);}};const onPasswordSubmit=async data=>{setLoading(true);setError('');setMessage('');try{await usersAPI.changePassword(data);setMessage('Password changed successfully!');resetPassword();}catch(err){var _err$response2,_err$response2$data;setError(((_err$response2=err.response)===null||_err$response2===void 0?void 0:(_err$response2$data=_err$response2.data)===null||_err$response2$data===void 0?void 0:_err$response2$data.message)||'Failed to change password');}finally{setLoading(false);}};return/*#__PURE__*/_jsx(Container,{maxWidth:\"md\",children:/*#__PURE__*/_jsx(Box,{sx:{mt:4,mb:4},children:/*#__PURE__*/_jsxs(Paper,{elevation:3,children:[/*#__PURE__*/_jsx(Box,{sx:{borderBottom:1,borderColor:'divider'},children:/*#__PURE__*/_jsxs(Tabs,{value:tabValue,onChange:handleTabChange,children:[/*#__PURE__*/_jsx(Tab,{label:\"Profile Information\"}),/*#__PURE__*/_jsx(Tab,{label:\"Change Password\"})]})}),message&&/*#__PURE__*/_jsx(Alert,{severity:\"success\",sx:{m:2},children:message}),error&&/*#__PURE__*/_jsx(Alert,{severity:\"error\",sx:{m:2},children:error}),/*#__PURE__*/_jsxs(TabPanel,{value:tabValue,index:0,children:[/*#__PURE__*/_jsx(Typography,{variant:\"h5\",gutterBottom:true,children:\"Profile Information\"}),/*#__PURE__*/_jsxs(Box,{component:\"form\",onSubmit:handleProfileSubmit(onProfileSubmit),children:[/*#__PURE__*/_jsxs(Grid,{container:true,spacing:3,children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,children:/*#__PURE__*/_jsx(TextField,_objectSpread(_objectSpread({fullWidth:true,label:\"First Name\"},registerProfile('first_name')),{},{error:!!profileErrors.first_name,helperText:(_profileErrors$first_=profileErrors.first_name)===null||_profileErrors$first_===void 0?void 0:_profileErrors$first_.message}))}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,children:/*#__PURE__*/_jsx(TextField,_objectSpread(_objectSpread({fullWidth:true,label:\"Last Name\"},registerProfile('last_name')),{},{error:!!profileErrors.last_name,helperText:(_profileErrors$last_n=profileErrors.last_name)===null||_profileErrors$last_n===void 0?void 0:_profileErrors$last_n.message}))}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,children:/*#__PURE__*/_jsx(TextField,_objectSpread(_objectSpread({fullWidth:true,label:\"Full Name\"},registerProfile('full_name')),{},{error:!!profileErrors.full_name,helperText:(_profileErrors$full_n=profileErrors.full_name)===null||_profileErrors$full_n===void 0?void 0:_profileErrors$full_n.message}))}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,children:/*#__PURE__*/_jsxs(FormControl,{fullWidth:true,children:[/*#__PURE__*/_jsx(InputLabel,{children:\"Gender\"}),/*#__PURE__*/_jsxs(Select,_objectSpread(_objectSpread({label:\"Gender\"},registerProfile('gender')),{},{error:!!profileErrors.gender,children:[/*#__PURE__*/_jsx(MenuItem,{value:\"Male\",children:\"Male\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"Female\",children:\"Female\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"Other\",children:\"Other\"})]}))]})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,children:/*#__PURE__*/_jsx(TextField,_objectSpread(_objectSpread({fullWidth:true,label:\"Date of Birth\",type:\"date\",InputLabelProps:{shrink:true}},registerProfile('dob')),{},{error:!!profileErrors.dob,helperText:(_profileErrors$dob=profileErrors.dob)===null||_profileErrors$dob===void 0?void 0:_profileErrors$dob.message}))}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,children:/*#__PURE__*/_jsx(TextField,_objectSpread(_objectSpread({fullWidth:true,label:\"Mobile\"},registerProfile('mobile')),{},{error:!!profileErrors.mobile,helperText:(_profileErrors$mobile=profileErrors.mobile)===null||_profileErrors$mobile===void 0?void 0:_profileErrors$mobile.message}))}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,children:/*#__PURE__*/_jsx(TextField,_objectSpread(_objectSpread({fullWidth:true,label:\"Alternate Mobile\"},registerProfile('alternate_mobile')),{},{error:!!profileErrors.alternate_mobile,helperText:(_profileErrors$altern=profileErrors.alternate_mobile)===null||_profileErrors$altern===void 0?void 0:_profileErrors$altern.message}))}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,children:/*#__PURE__*/_jsx(TextField,_objectSpread(_objectSpread({fullWidth:true,label:\"Address\",multiline:true,rows:3},registerProfile('address')),{},{error:!!profileErrors.address,helperText:(_profileErrors$addres=profileErrors.address)===null||_profileErrors$addres===void 0?void 0:_profileErrors$addres.message}))}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,children:/*#__PURE__*/_jsx(TextField,_objectSpread(_objectSpread({fullWidth:true,label:\"Pincode\"},registerProfile('pincode')),{},{error:!!profileErrors.pincode,helperText:(_profileErrors$pincod=profileErrors.pincode)===null||_profileErrors$pincod===void 0?void 0:_profileErrors$pincod.message}))}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:4,children:/*#__PURE__*/_jsxs(FormControl,{fullWidth:true,children:[/*#__PURE__*/_jsx(InputLabel,{children:\"Country\"}),/*#__PURE__*/_jsx(Select,_objectSpread(_objectSpread({label:\"Country\"},registerProfile('country_id')),{},{error:!!profileErrors.country_id,children:countries.map(country=>/*#__PURE__*/_jsx(MenuItem,{value:country.id,children:country.country_name},country.id))}))]})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:4,children:/*#__PURE__*/_jsxs(FormControl,{fullWidth:true,children:[/*#__PURE__*/_jsx(InputLabel,{children:\"State\"}),/*#__PURE__*/_jsx(Select,_objectSpread(_objectSpread({label:\"State\"},registerProfile('state_id')),{},{error:!!profileErrors.state_id,disabled:!watchCountry,children:states.map(state=>/*#__PURE__*/_jsx(MenuItem,{value:state.id,children:state.state_name},state.id))}))]})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:4,children:/*#__PURE__*/_jsxs(FormControl,{fullWidth:true,children:[/*#__PURE__*/_jsx(InputLabel,{children:\"District\"}),/*#__PURE__*/_jsx(Select,_objectSpread(_objectSpread({label:\"District\"},registerProfile('district_id')),{},{error:!!profileErrors.district_id,disabled:!watchState,children:districts.map(district=>/*#__PURE__*/_jsx(MenuItem,{value:district.id,children:district.district_name},district.id))}))]})})]}),/*#__PURE__*/_jsx(Button,{type:\"submit\",variant:\"contained\",sx:{mt:3},disabled:loading,startIcon:loading?/*#__PURE__*/_jsx(CircularProgress,{size:20}):null,children:loading?'Updating...':'Update Profile'})]})]}),/*#__PURE__*/_jsxs(TabPanel,{value:tabValue,index:1,children:[/*#__PURE__*/_jsx(Typography,{variant:\"h5\",gutterBottom:true,children:\"Change Password\"}),/*#__PURE__*/_jsxs(Box,{component:\"form\",onSubmit:handlePasswordSubmit(onPasswordSubmit),children:[/*#__PURE__*/_jsxs(Grid,{container:true,spacing:3,children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:12,children:/*#__PURE__*/_jsx(TextField,_objectSpread(_objectSpread({fullWidth:true,label:\"Current Password\",type:\"password\"},registerPassword('currentPassword',{required:'Current password is required'})),{},{error:!!passwordErrors.currentPassword,helperText:(_passwordErrors$curre=passwordErrors.currentPassword)===null||_passwordErrors$curre===void 0?void 0:_passwordErrors$curre.message}))}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,children:/*#__PURE__*/_jsx(TextField,_objectSpread(_objectSpread({fullWidth:true,label:\"New Password\",type:\"password\"},registerPassword('newPassword',{required:'New password is required',minLength:{value:6,message:'Password must be at least 6 characters'}})),{},{error:!!passwordErrors.newPassword,helperText:(_passwordErrors$newPa=passwordErrors.newPassword)===null||_passwordErrors$newPa===void 0?void 0:_passwordErrors$newPa.message}))})]}),/*#__PURE__*/_jsx(Button,{type:\"submit\",variant:\"contained\",sx:{mt:3},disabled:loading,startIcon:loading?/*#__PURE__*/_jsx(CircularProgress,{size:20}):null,children:loading?'Changing...':'Change Password'})]})]})]})})});};export default Profile;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}